Create all the database tables in Supabase for the GetHiredAlly application.

DATABASE SCHEMA - Create these tables in order:

1. USER PROFILES & LIMITS (create first - other tables reference these)

CREATE TABLE user_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    profile_name TEXT NOT NULL UNIQUE,
    display_name TEXT NOT NULL,
    description TEXT,
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE profile_limits (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    profile_id UUID REFERENCES user_profiles(id),
    service_name TEXT NOT NULL,
    limit_count INTEGER NOT NULL,
    limit_period TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

2. USER MANAGEMENT

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    name TEXT,
    profile_id UUID REFERENCES user_profiles(id),
    is_verified BOOLEAN DEFAULT FALSE,
    is_admin BOOLEAN DEFAULT FALSE,
    admin_role TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    last_login TIMESTAMP
);

CREATE TABLE email_verification_codes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    code TEXT NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    used BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE password_reset_tokens (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    token TEXT NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    used BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE user_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    token_hash TEXT NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

3. SERVICE REGISTRY

CREATE TABLE services (
    id TEXT PRIMARY KEY,
    display_name TEXT NOT NULL,
    description TEXT,
    icon TEXT,
    route TEXT NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    is_coming_soon BOOLEAN DEFAULT FALSE,
    requires_xray BOOLEAN DEFAULT FALSE,
    display_order INTEGER,
    created_at TIMESTAMP DEFAULT NOW()
);

4. USAGE TRACKING

CREATE TABLE usage_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    service_name TEXT NOT NULL,
    period_start DATE NOT NULL,
    period_end DATE NOT NULL,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, service_name, period_start)
);

5. PROMPT TEMPLATES

CREATE TABLE prompt_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    service_name TEXT NOT NULL,
    mode TEXT NOT NULL,
    template_type TEXT NOT NULL,
    category_id INTEGER,
    content TEXT NOT NULL,
    version INTEGER DEFAULT 1,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

6. ANALYSIS SESSIONS & RESULTS

CREATE TABLE analysis_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    service_name TEXT NOT NULL,
    job_description_text TEXT NOT NULL,
    job_title TEXT,
    company_name TEXT,
    mode TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE analysis_results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID REFERENCES analysis_sessions(id),
    report_markdown TEXT,
    structured_data JSONB,
    validation_status TEXT,
    validation_details JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

7. STATIC QUESTIONS DATABASE

CREATE TABLE interview_questions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    category TEXT NOT NULL,
    subcategory TEXT,
    question_text TEXT NOT NULL,
    why_they_ask TEXT,
    framework TEXT,
    answer_structure TEXT,
    good_elements TEXT[],
    bad_elements TEXT[],
    variations TEXT[],
    depth_levels TEXT[] NOT NULL,
    order_priority INTEGER,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE questions_to_ask (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    purpose TEXT NOT NULL,
    category TEXT NOT NULL,
    question_text TEXT NOT NULL,
    why_to_ask TEXT,
    good_timing TEXT,
    order_priority INTEGER,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

8. INSERT DEFAULT DATA

-- Default profiles
INSERT INTO user_profiles (profile_name, display_name, description, is_default) VALUES
('standard', 'Standard User', 'Default free user with basic limits', true),
('special', 'Special User', 'Promotional or survey participant', false),
('vip', 'VIP User', 'Unlimited access for promoters', false);

-- Profile limits (get profile IDs first, then insert)
-- For standard: xray=1/week, questions_static=5/total, questions_dynamic=1/week
-- For special: xray=3/week, questions_static=5/total, questions_dynamic=3/week
-- For vip: xray=20/week, questions_static=-1/unlimited, questions_dynamic=20/week

-- Default services
INSERT INTO services (id, display_name, description, icon, route, is_active, display_order) VALUES
('xray', 'Understand This Job', 'Decode what employers really want from the job description', 'üîç', '/xray', true, 1),
('questions', 'Prepare for Questions', 'Know what they will ask and how to answer', '‚ùì', '/questions', true, 2),
('playbook', 'Craft Your Answers', 'Build your personal interview playbook', 'üìñ', '/playbook', false, 3);

After creating tables, verify they exist in the Supabase dashboard.