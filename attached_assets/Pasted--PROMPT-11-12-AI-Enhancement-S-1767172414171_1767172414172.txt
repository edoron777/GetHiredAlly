═══════════════════════════════════════════════════════════════════
PROMPT 11#12: AI Enhancement (Suggestions Only)
═══════════════════════════════════════════════════════════════════

⚠️ CRITICAL COMPLIANCE ⚠️
- Execute ONLY instructions below
- AI should ONLY enhance existing issues
- AI should NOT detect new issues

───────────────────────────────────────────────────────────────────

TASK: Create AI enhancement for suggestions only

OBJECTIVE:
AI adds value by:
- Generating specific improvement suggestions
- Providing personalized explanations
- Creating rewrite examples

AI does NOT:
- Detect issues (that's CODE's job)
- Decide what's wrong (that's CODE's job)
- Change issue counts (that's fixed by CODE)

───────────────────────────────────────────────────────────────────

INSTRUCTIONS:

Step 1: CREATE file: backend/common/detection/ai_enhancer.py

Step 2: Add this content:

"""
AI Enhancement Module

Enhances CODE-detected issues with AI-generated suggestions.
AI does NOT detect issues - only provides suggestions for existing issues.

RULE: Issue count is FIXED by CODE. AI only adds suggestions.
"""

import logging
from typing import List, Dict, Any, Optional

logger = logging.getLogger(__name__)


# Templates for suggestions (no AI needed for basic suggestions)
SUGGESTION_TEMPLATES = {
    'SPELLING_ERROR': 'Check spelling and correct "{current}" to proper spelling',
    'GRAMMAR_ERROR': 'Review grammar and fix the error',
    'MISSING_EMAIL': 'Add a professional email address (e.g., firstname.lastname@gmail.com)',
    'MISSING_PHONE': 'Add a phone number with country code if applying internationally',
    'MISSING_LINKEDIN': 'Add your LinkedIn profile URL to increase professional visibility',
    'NO_METRICS': 'Add specific numbers, percentages, or dollar amounts to quantify your achievement',
    'WEAK_ACTION_VERBS': 'Replace with strong verbs like: led, achieved, delivered, increased, reduced',
    'VAGUE_DESCRIPTION': 'Replace vague words with specific details and measurable outcomes',
    'BUZZWORD_STUFFING': 'Replace buzzwords with concrete achievements and specific results',
    'WEAK_SUMMARY': 'Write a compelling 3-4 sentence summary highlighting your key qualifications',
    'SECTION_ORDER': 'Move Experience section before Education for non-students',
    'CV_TOO_LONG': 'Focus on recent, relevant experience and remove outdated information',
    'CV_TOO_SHORT': 'Add more detail to your experience and achievements',
    'BULLET_TOO_LONG': 'Split into multiple focused bullets or condense key points',
    'BULLET_TOO_SHORT': 'Add more detail about the achievement and its impact',
    'BULLET_FORMAT': 'Start bullet with a strong action verb (e.g., Led, Achieved, Developed)',
    'FORMAT_INCONSISTENT': 'Use consistent formatting throughout the document',
    'DATE_FORMAT_INCONSISTENT': 'Use one date format throughout (e.g., "Jan 2020" or "January 2020")',
    'WHITESPACE_ISSUE': 'Remove extra blank lines and ensure consistent spacing',
    'OUTDATED_INFO': 'Consider removing experience older than 10-15 years',
    'HEADER_STYLE': 'Use consistent capitalization for all section headers',
    'REPETITIVE_CONTENT': 'Vary your language to avoid repeating the same phrases',
}


def add_basic_suggestions(issues: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
    """
    Add template-based suggestions to issues.
    
    This is fast and deterministic - no AI call needed.
    
    Args:
        issues: List of issues from static detection
        
    Returns:
        Same issues with 'suggestion' field added/enhanced
    """
    for issue in issues:
        issue_type = issue.get('issue_type', '')
        
        # Add template suggestion if not already present
        if 'suggestion' not in issue or not issue['suggestion']:
            template = SUGGESTION_TEMPLATES.get(issue_type, 'Review and improve this section')
            
            # Personalize if 'current' field exists
            if '{current}' in template and 'current' in issue:
                suggestion = template.format(current=issue['current'])
            else:
                suggestion = template
            
            issue['suggestion'] = suggestion
    
    return issues


async def enhance_with_ai(
    issues: List[Dict[str, Any]],
    cv_text: str,
    ai_client: Any,
    max_enhancements: int = 5
) -> List[Dict[str, Any]]:
    """
    Optionally enhance top issues with AI-generated suggestions.
    
    ⚠️ AI does NOT:
    - Add new issues
    - Remove issues
    - Change issue counts
    - Decide what's wrong
    
    AI ONLY:
    - Provides better suggestions for existing issues
    - Generates rewrite examples
    
    Args:
        issues: List of issues from static detection
        cv_text: Full CV text for context
        ai_client: AI client for generating suggestions
        max_enhancements: Maximum issues to enhance with AI
        
    Returns:
        Same issues with enhanced suggestions (count unchanged)
    """
    # First add basic suggestions
    issues = add_basic_suggestions(issues)
    
    # Skip AI enhancement if no client provided
    if not ai_client:
        logger.info("No AI client - using template suggestions only")
        return issues
    
    # Only enhance high-priority issues with AI
    high_priority = [i for i in issues if i.get('severity') in ['critical', 'high']][:max_enhancements]
    
    if not high_priority:
        return issues
    
    # TODO: Implement AI enhancement for specific issues
    # This is OPTIONAL and should only provide better suggestions
    # It should NEVER change issue counts
    
    logger.info(f"AI enhancement skipped (not yet implemented)")
    
    return issues

───────────────────────────────────────────────────────────────────

FILES TO CREATE:
- backend/common/detection/ai_enhancer.py

DO NOT TOUCH:
- master_detector.py (detection is separate from enhancement)
- cv_optimizer.py (already modified)

───────────────────────────────────────────────────────────────────

WHEN COMPLETE:

Confirm:
□ ai_enhancer.py created
□ SUGGESTION_TEMPLATES covers all issue types
□ add_basic_suggestions adds suggestions to issues
□ AI enhancement does NOT change issue count
□ No Python syntax errors

Type "PROMPT 11#12 COMPLETE - READY FOR 12#12" when done.