â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PROMPT 12#12: Verification & Determinism Testing
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ CRITICAL: This tests that the fix actually works

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

TASK: Verify static detection is deterministic

OBJECTIVE:
Run multiple tests to confirm:
- Same CV â†’ Same issues (every time)
- CODE detects issues (not AI)
- Integration works correctly

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

INSTRUCTIONS:

Step 1: CREATE test file: backend/tests/test_determinism.py

"""
Determinism Tests for Static CV Detection

These tests verify that issue detection is DETERMINISTIC:
- Same CV text â†’ Same issues (100% of the time)
- Same issue count (100% of the time)
- Same issue types (100% of the time)
"""

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from common.detection import detect_all_issues
from common.scoring.severity import assign_severity_to_issues


# Test CV text
TEST_CV = """
John Doe
john@example.com
555-123-4567

SUMMARY
Experienced professional with various skills and multiple years of experience.

EXPERIENCE

Senior Developer at TechCorp (Jan 2020 - Present)
- Responsible for managing team
- Helped with various projects and stuff
- Worked on different things

Developer at StartupInc (2018 - 2020)
- Assisted with development
- Handled multiple tasks
- Did coding work

EDUCATION

Bachelor of Science in Computer Science
University of Example, 2018

SKILLS
Python, JavaScript, SQL, Leadership, Communication
"""


def test_same_issues_every_time():
    """
    CRITICAL TEST: Same CV must produce same issues.
    Run 10 times, compare results.
    """
    print("Test 1: Same CV â†’ Same issues (10 runs)")
    
    results = []
    for i in range(10):
        issues = detect_all_issues(TEST_CV)
        issue_types = tuple(sorted([iss['issue_type'] for iss in issues]))
        results.append(issue_types)
    
    # All results must be identical
    unique_results = set(results)
    
    assert len(unique_results) == 1, \
        f"FAIL: Got {len(unique_results)} different results in 10 runs!"
    
    print(f"âœ… PASSED: All 10 runs produced identical issues ({len(results[0])} issues)")
    return True


def test_same_count_every_time():
    """
    Test that issue COUNT is consistent.
    """
    print("Test 2: Same issue count (10 runs)")
    
    counts = []
    for i in range(10):
        issues = detect_all_issues(TEST_CV)
        counts.append(len(issues))
    
    unique_counts = set(counts)
    
    assert len(unique_counts) == 1, \
        f"FAIL: Got different counts: {unique_counts}"
    
    print(f"âœ… PASSED: All 10 runs produced {counts[0]} issues")
    return True


def test_severity_assignment():
    """
    Test that severity assignment is deterministic.
    """
    print("Test 3: Severity assignment (10 runs)")
    
    results = []
    for i in range(10):
        issues = detect_all_issues(TEST_CV)
        issues = assign_severity_to_issues(issues)
        severities = tuple(sorted([iss['severity'] for iss in issues]))
        results.append(severities)
    
    unique_results = set(results)
    
    assert len(unique_results) == 1, \
        f"FAIL: Got different severities in different runs!"
    
    # Count by severity
    issues = detect_all_issues(TEST_CV)
    issues = assign_severity_to_issues(issues)
    
    from collections import Counter
    counts = Counter([iss['severity'] for iss in issues])
    
    print(f"âœ… PASSED: Consistent severities - {dict(counts)}")
    return True


def test_specific_detections():
    """
    Test that specific issues are detected correctly.
    """
    print("Test 4: Specific issue detection")
    
    issues = detect_all_issues(TEST_CV)
    issue_types = [iss['issue_type'] for iss in issues]
    
    # Should detect these
    expected = [
        'WEAK_ACTION_VERBS',  # "Responsible for", "Helped with", etc.
        'VAGUE_DESCRIPTION',  # "various", "stuff", "things"
        'NO_METRICS',         # Bullets have no numbers
    ]
    
    for expected_type in expected:
        assert expected_type in issue_types, \
            f"FAIL: Expected {expected_type} to be detected"
        print(f"  âœ“ {expected_type} detected")
    
    print("âœ… PASSED: All expected issues detected")
    return True


def run_all_tests():
    """Run all determinism tests."""
    print("\n" + "="*60)
    print("DETERMINISM TESTS FOR STATIC CV DETECTION")
    print("="*60 + "\n")
    
    tests = [
        test_same_issues_every_time,
        test_same_count_every_time,
        test_severity_assignment,
        test_specific_detections,
    ]
    
    passed = 0
    failed = 0
    
    for test in tests:
        try:
            test()
            passed += 1
        except AssertionError as e:
            print(f"âŒ {e}")
            failed += 1
        except Exception as e:
            print(f"âŒ ERROR: {e}")
            failed += 1
        print()
    
    print("="*60)
    print(f"RESULTS: {passed} passed, {failed} failed")
    print("="*60)
    
    if failed == 0:
        print("\nğŸ‰ ALL TESTS PASSED - Detection is DETERMINISTIC!")
    else:
        print("\nâš ï¸ SOME TESTS FAILED - Please fix before proceeding")
    
    return failed == 0


if __name__ == '__main__':
    success = run_all_tests()
    sys.exit(0 if success else 1)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 2: Run the tests

cd backend
python tests/test_determinism.py

Step 3: Report results

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

EXPECTED OUTPUT:

============================================================
DETERMINISM TESTS FOR STATIC CV DETECTION
============================================================

Test 1: Same CV â†’ Same issues (10 runs)
âœ… PASSED: All 10 runs produced identical issues (X issues)

Test 2: Same issue count (10 runs)
âœ… PASSED: All 10 runs produced X issues

Test 3: Severity assignment (10 runs)
âœ… PASSED: Consistent severities - {'critical': X, 'high': Y, ...}

Test 4: Specific issue detection
  âœ“ WEAK_ACTION_VERBS detected
  âœ“ VAGUE_DESCRIPTION detected
  âœ“ NO_METRICS detected
âœ… PASSED: All expected issues detected

============================================================
RESULTS: 4 passed, 0 failed
============================================================

ğŸ‰ ALL TESTS PASSED - Detection is DETERMINISTIC!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

FILES TO CREATE:
- backend/tests/test_determinism.py

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

FINAL VERIFICATION:

After all 12 prompts:

â–¡ Test 1 passed: Same issues every time
â–¡ Test 2 passed: Same count every time
â–¡ Test 3 passed: Same severities every time
â–¡ Test 4 passed: Expected issues detected

If all pass: DETERMINISM ACHIEVED âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FINAL PROMPT: SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

All 12 prompts executed. Report:

1. FILES CREATED:
   - backend/common/detection/__init__.py
   - backend/common/detection/word_lists.py
   - backend/common/detection/contact_extractor.py
   - backend/common/detection/section_extractor.py
   - backend/common/detection/bullet_extractor.py
   - backend/common/detection/spelling_detector.py
   - backend/common/detection/language_detector.py
   - backend/common/detection/format_detector.py
   - backend/common/detection/polish_detector.py
   - backend/common/detection/master_detector.py
   - backend/common/detection/ai_enhancer.py
   - backend/tests/test_determinism.py

2. FILES MODIFIED:
   - backend/app/cv_optimizer.py (use static detection)

3. DETERMINISM TEST RESULTS:
   â–¡ All 4 tests passed: YES/NO

4. VERIFICATION:
   Same CV uploaded 3 times produces: IDENTICAL / DIFFERENT results

FINAL STATUS:
â–¡ Static detection implemented
â–¡ CODE detects 80% of issues
â–¡ Same CV = Same result
â–¡ Determinism achieved

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•