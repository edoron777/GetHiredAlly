## TASK: Create Admin Dashboard Frontend UI

### OVERVIEW
Create the admin dashboard page to view AI usage statistics and costs.

### STEP 1: Create Admin Dashboard Page

Create file: src/pages/admin/AIUsageDashboard.jsx

import React, { useState, useEffect } from 'react';
import { useAuth } from '../../hooks/useAuth';

const AIUsageDashboard = () => {
    const { user } = useAuth();
    const [summary, setSummary] = useState(null);
    const [dailyData, setDailyData] = useState([]);
    const [recentLogs, setRecentLogs] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const [dateRange, setDateRange] = useState(30);

    useEffect(() => {
        loadDashboardData();
    }, [dateRange]);

    const loadDashboardData = async () => {
        setLoading(true);
        try {
            const [summaryRes, dailyRes, recentRes] = await Promise.all([
                fetch(`/api/admin/ai-usage/summary?user_id=${user.id}`),
                fetch(`/api/admin/ai-usage/daily?user_id=${user.id}&days=${dateRange}`),
                fetch(`/api/admin/ai-usage/recent?user_id=${user.id}&limit=20`)
            ]);

            if (!summaryRes.ok) {
                throw new Error('Access denied. Admin privileges required.');
            }

            setSummary(await summaryRes.json());
            setDailyData(await dailyRes.json());
            setRecentLogs(await recentRes.json());
        } catch (err) {
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    if (loading) {
        return (
            <div className="flex items-center justify-center min-h-screen">
                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            </div>
        );
    }

    if (error) {
        return (
            <div className="p-8">
                <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                    <p className="text-red-800">‚ùå {error}</p>
                </div>
            </div>
        );
    }

    return (
        <div className="p-6 max-w-7xl mx-auto">
            {/* Header */}
            <div className="mb-8">
                <h1 className="text-2xl font-bold text-gray-900">üìä AI Usage Dashboard</h1>
                <p className="text-gray-600">Monitor AI costs and usage across all services</p>
            </div>

            {/* Date Range Selector */}
            <div className="mb-6 flex gap-2">
                {[7, 14, 30, 90].map((days) => (
                    <button
                        key={days}
                        onClick={() => setDateRange(days)}
                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                            dateRange === days
                                ? 'bg-blue-600 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                    >
                        {days} days
                    </button>
                ))}
            </div>

            {/* Summary Cards */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <SummaryCard
                    title="Total Cost"
                    value={`$${summary?.summary?.total_cost_usd?.toFixed(2) || '0.00'}`}
                    icon="üí∞"
                    color="blue"
                />
                <SummaryCard
                    title="Total Requests"
                    value={summary?.summary?.total_requests || 0}
                    icon="üìä"
                    color="green"
                />
                <SummaryCard
                    title="Success Rate"
                    value={`${summary?.summary?.success_rate || 0}%`}
                    icon="‚úÖ"
                    color="emerald"
                />
                <SummaryCard
                    title="Avg Response"
                    value={`${summary?.summary?.avg_response_time_ms || 0}ms`}
                    icon="‚ö°"
                    color="purple"
                />
            </div>

            {/* Provider & Service Breakdown */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                {/* By Provider */}
                <div className="bg-white rounded-lg border p-6">
                    <h2 className="text-lg font-semibold mb-4">By Provider</h2>
                    {summary?.by_provider && Object.entries(summary.by_provider).map(([provider, data]) => (
                        <div key={provider} className="mb-4">
                            <div className="flex justify-between mb-1">
                                <span className="font-medium capitalize">
                                    {provider === 'claude' ? 'üß† Claude' : '‚ú® Gemini'}
                                </span>
                                <span className="text-gray-600">
                                    ${data.cost?.toFixed(2)} ({data.requests} requests)
                                </span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div
                                    className={`h-2 rounded-full ${
                                        provider === 'claude' ? 'bg-purple-500' : 'bg-green-500'
                                    }`}
                                    style={{
                                        width: `${(data.cost / (summary.summary.total_cost_usd || 1)) * 100}%`
                                    }}
                                ></div>
                            </div>
                        </div>
                    ))}
                </div>

                {/* By Service */}
                <div className="bg-white rounded-lg border p-6">
                    <h2 className="text-lg font-semibold mb-4">By Service</h2>
                    {summary?.by_service && Object.entries(summary.by_service).map(([service, data]) => (
                        <div key={service} className="mb-4">
                            <div className="flex justify-between mb-1">
                                <span className="font-medium">
                                    {service === 'xray' ? 'üîç X-Ray Analyzer' : 
                                     service === 'smart_questions' ? 'üéØ Smart Questions' :
                                     service}
                                </span>
                                <span className="text-gray-600">
                                    ${data.cost?.toFixed(2)} ({data.requests} requests)
                                </span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div
                                    className="h-2 rounded-full bg-blue-500"
                                    style={{
                                        width: `${(data.cost / (summary.summary.total_cost_usd || 1)) * 100}%`
                                    }}
                                ></div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            {/* Recent Logs Table */}
            <div className="bg-white rounded-lg border overflow-hidden">
                <div className="px-6 py-4 border-b">
                    <h2 className="text-lg font-semibold">Recent AI Calls</h2>
                </div>
                <div className="overflow-x-auto">
                    <table className="w-full">
                        <thead className="bg-gray-50">
                            <tr>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Service</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Provider</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tokens</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cost</th>
                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-200">
                            {recentLogs.map((log) => (
                                <tr key={log.id} className="hover:bg-gray-50">
                                    <td className="px-4 py-3 text-sm text-gray-600">
                                        {new Date(log.created_at).toLocaleString()}
                                    </td>
                                    <td className="px-4 py-3 text-sm">
                                        {log.service_type === 'xray' ? 'üîç X-Ray' : 
                                         log.service_type === 'smart_questions' ? 'üéØ Smart Q' :
                                         log.service_type}
                                    </td>
                                    <td className="px-4 py-3 text-sm">
                                        {log.ai_provider === 'claude' ? 'üß† Claude' : '‚ú® Gemini'}
                                    </td>
                                    <td className="px-4 py-3 text-sm text-gray-600">
                                        {(log.input_tokens || 0) + (log.output_tokens || 0)}
                                    </td>
                                    <td className="px-4 py-3 text-sm font-medium">
                                        ${log.cost_usd?.toFixed(4) || '0.0000'}
                                    </td>
                                    <td className="px-4 py-3">
                                        {log.success ? (
                                            <span className="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                                                Success
                                            </span>
                                        ) : (
                                            <span className="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">
                                                Failed
                                            </span>
                                        )}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
};

// Summary Card Component
const SummaryCard = ({ title, value, icon, color }) => {
    const colorClasses = {
        blue: 'bg-blue-50 border-blue-200',
        green: 'bg-green-50 border-green-200',
        emerald: 'bg-emerald-50 border-emerald-200',
        purple: 'bg-purple-50 border-purple-200'
    };

    return (
        <div className={`rounded-lg border p-4 ${colorClasses[color]}`}>
            <div className="flex items-center gap-2 mb-1">
                <span className="text-xl">{icon}</span>
                <span className="text-sm text-gray-600">{title}</span>
            </div>
            <div className="text-2xl font-bold text-gray-900">{value}</div>
        </div>
    );
};

export default AIUsageDashboard;

### STEP 2: Add Route and Navigation

1. Add route in your router config (App.jsx or routes.js):
import AIUsageDashboard from './pages/admin/AIUsageDashboard';

// In your routes:
<Route path="/admin/ai-usage" element={<AIUsageDashboard />} />

2. Add navigation link in sidebar (only for admins):
{user?.is_admin && (
    <NavLink to="/admin/ai-usage">
        üìä AI Usage
    </NavLink>
)}

### STEP 3: Add Admin Check to User Context

Make sure your auth hook/context includes is_admin:

// When fetching user data, include is_admin field
const userData = await supabase
    .from('users')
    .select('*, is_admin')
    .eq('id', userId)
    .single();

### SUCCESS CHECKLIST
- [ ] AIUsageDashboard page created
- [ ] Route added: /admin/ai-usage
- [ ] Navigation link added (admin only)
- [ ] Summary cards display correctly
- [ ] Provider breakdown shows
- [ ] Service breakdown shows
- [ ] Recent logs table displays
- [ ] Date range filter works
- [ ] Non-admin users see error message