â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸ’» DEBUG-LOG: Add Comprehensive Logging to Trace Merge Issue
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ CRITICAL: This adds LOGGING ONLY - no logic changes yet
We need to see exactly what's happening at each step.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE TO EDIT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

File: client/src/components/cv-optimizer/DocumentView/StructureOverlay.tsx

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 1: Add Debug Function at Top of Component
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Inside the StructureOverlay component, add this debug function:
```tsx
// ============= DEBUG LOGGING =============
const debugLog = (section: string, data: any) => {
  console.log(`\nðŸ” [${section}]`, JSON.stringify(data, null, 2));
};

const debugBlocks = (label: string, blocks: CVBlock[]) => {
  console.log(`\nðŸ“‹ [${label}] Total blocks: ${blocks.length}`);
  blocks.forEach((block, i) => {
    console.log(`  Block ${i}: type=${block.type}, lines=${block.start_line}-${block.end_line}, wordCount=${block.word_count}`);
  });
};

const debugContent = (label: string, content: string) => {
  const lines = content.split('\n');
  console.log(`\nðŸ“„ [${label}]`);
  console.log(`  Total chars: ${content.length}`);
  console.log(`  Total lines: ${lines.length}`);
  console.log(`  First 3 lines:`);
  lines.slice(0, 3).forEach((line, i) => {
    console.log(`    ${i + 1}: "${line.substring(0, 80)}${line.length > 80 ? '...' : ''}"`);
  });
  console.log(`  Last 3 lines:`);
  lines.slice(-3).forEach((line, i) => {
    console.log(`    ${lines.length - 2 + i}: "${line.substring(0, 80)}${line.length > 80 ? '...' : ''}"`);
  });
};
// =========================================
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 2: Add Logging to Component Mount
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Add or update useEffect for initial logging:
```tsx
useEffect(() => {
  console.log('\n' + '='.repeat(60));
  console.log('ðŸš€ StructureOverlay MOUNTED');
  console.log('='.repeat(60));
  
  // Log cvContent status
  console.log('\nðŸ“ cvContent:');
  console.log(`  Received: ${cvContent ? 'YES' : 'NO'}`);
  console.log(`  Length: ${cvContent?.length || 0} chars`);
  console.log(`  Lines: ${cvContent?.split('\n').length || 0}`);
  
  if (cvContent) {
    const lines = cvContent.split('\n');
    console.log(`  First line: "${lines[0]?.substring(0, 50)}..."`);
    console.log(`  Last line: "${lines[lines.length - 1]?.substring(0, 50)}..."`);
  }
  
  // Log blocks received
  debugBlocks('Initial blocks from props', blocks);
  
}, [cvContent, blocks]);
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 3: Add Detailed Logging to extractContent
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Find the extractContent function and REPLACE it with this version:
```tsx
const extractContent = (startLine: number, endLine: number): string => {
  console.log('\n' + '-'.repeat(40));
  console.log(`ðŸ“¤ extractContent(${startLine}, ${endLine})`);
  
  if (!cvContent) {
    console.error('  âŒ ERROR: cvContent is null/undefined!');
    return '';
  }
  
  if (cvContent.length === 0) {
    console.error('  âŒ ERROR: cvContent is empty string!');
    return '';
  }
  
  const allLines = cvContent.split('\n');
  console.log(`  cvContent total lines: ${allLines.length}`);
  
  // Convert to 0-indexed
  const startIdx = Math.max(0, startLine - 1);
  const endIdx = Math.min(allLines.length, endLine);
  
  console.log(`  Requested: lines ${startLine} to ${endLine}`);
  console.log(`  Array indices: ${startIdx} to ${endIdx}`);
  console.log(`  Lines to extract: ${endIdx - startIdx}`);
  
  // Check if indices are valid
  if (startIdx >= allLines.length) {
    console.error(`  âŒ ERROR: startIdx (${startIdx}) >= total lines (${allLines.length})`);
    return '';
  }
  
  if (endIdx <= startIdx) {
    console.error(`  âŒ ERROR: endIdx (${endIdx}) <= startIdx (${startIdx})`);
    return '';
  }
  
  const extracted = allLines.slice(startIdx, endIdx);
  const content = extracted.join('\n');
  
  console.log(`  âœ… Extracted ${extracted.length} lines`);
  console.log(`  Content length: ${content.length} chars`);
  console.log(`  First line: "${extracted[0]?.substring(0, 60)}..."`);
  console.log(`  Last line: "${extracted[extracted.length - 1]?.substring(0, 60)}..."`);
  console.log('-'.repeat(40));
  
  return content;
};
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 4: Add Detailed Logging to handleMergeUp
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

REPLACE handleMergeUp with this heavily-logged version:
```tsx
const handleMergeUp = (index: number) => {
  console.log('\n' + '='.repeat(60));
  console.log('ðŸ”€ MERGE UP STARTED');
  console.log('='.repeat(60));
  
  console.log(`\nðŸ“ Merge index: ${index}`);
  
  if (index === 0) {
    console.log('âŒ Cannot merge first section - aborting');
    return;
  }
  
  // Log current state BEFORE merge
  console.log('\nðŸ“‹ STATE BEFORE MERGE:');
  debugBlocks('localBlocks before', localBlocks);
  
  const currentBlock = localBlocks[index];
  const aboveBlock = localBlocks[index - 1];
  
  console.log('\nðŸŽ¯ BLOCKS TO MERGE:');
  console.log('Above block (will absorb):');
  console.log(`  Type: ${aboveBlock.type}`);
  console.log(`  Lines: ${aboveBlock.start_line} - ${aboveBlock.end_line}`);
  console.log(`  Word count: ${aboveBlock.word_count}`);
  
  console.log('Current block (will be absorbed):');
  console.log(`  Type: ${currentBlock.type}`);
  console.log(`  Lines: ${currentBlock.start_line} - ${currentBlock.end_line}`);
  console.log(`  Word count: ${currentBlock.word_count}`);
  
  // Extract content with logging
  console.log('\nðŸ“¤ EXTRACTING CONTENT:');
  const aboveContent = extractContent(aboveBlock.start_line, aboveBlock.end_line);
  const currentContent = extractContent(currentBlock.start_line, currentBlock.end_line);
  
  console.log('\nðŸ“Š CONTENT SUMMARY:');
  console.log(`  Above content: ${aboveContent.length} chars, ${aboveContent.split('\n').length} lines`);
  console.log(`  Current content: ${currentContent.length} chars, ${currentContent.split('\n').length} lines`);
  
  // Create merged content
  const mergedContent = aboveContent + '\n' + currentContent;
  console.log(`  Merged content: ${mergedContent.length} chars, ${mergedContent.split('\n').length} lines`);
  
  // Verify merge math
  const expectedLength = aboveContent.length + 1 + currentContent.length;
  console.log(`  Expected length: ${expectedLength}, Actual: ${mergedContent.length}`);
  if (mergedContent.length !== expectedLength) {
    console.warn('  âš ï¸ WARNING: Content length mismatch!');
  }
  
  setLocalBlocks(prev => {
    console.log('\nðŸ”„ setLocalBlocks callback executing...');
    
    const newBlocks = [...prev];
    
    // Create merged block
    const merged: CVBlock = {
      ...aboveBlock,
      start_line: aboveBlock.start_line,
      end_line: currentBlock.end_line,
      content_preview: mergedContent.split('\n').slice(0, 2).join(' ').substring(0, 100),
      word_count: mergedContent.split(/\s+/).filter(Boolean).length,
    };
    
    console.log('\nâœ¨ MERGED BLOCK CREATED:');
    console.log(`  Type: ${merged.type}`);
    console.log(`  Lines: ${merged.start_line} - ${merged.end_line}`);
    console.log(`  Word count: ${merged.word_count}`);
    
    // Replace and remove
    newBlocks[index - 1] = merged;
    newBlocks.splice(index, 1);
    
    console.log('\nðŸ“‹ STATE AFTER MERGE:');
    debugBlocks('newBlocks after', newBlocks);
    
    // Call parent callback
    if (onStructureChange) {
      console.log('\nðŸ“¨ Calling onStructureChange...');
      onStructureChange(newBlocks);
      console.log('âœ… onStructureChange called');
    } else {
      console.warn('âš ï¸ WARNING: onStructureChange is not defined!');
    }
    
    console.log('\n' + '='.repeat(60));
    console.log('ðŸ”€ MERGE UP COMPLETED');
    console.log('='.repeat(60) + '\n');
    
    return newBlocks;
  });
  
  setOpenDropdown(null);
};
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 5: Add Logging to getBlockContent (Rendering)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Find getBlockContent and add logging:
```tsx
const getBlockContent = (block: CVBlock): string[] => {
  // Only log once per block (not on every render)
  const startIdx = Math.max(0, block.start_line - 1);
  const endIdx = Math.min(lines.length, block.end_line);
  const content = lines.slice(startIdx, endIdx);
  
  // Debug: Log when content seems wrong
  if (content.length < 5 && (block.end_line - block.start_line) > 5) {
    console.warn(`âš ï¸ getBlockContent: Expected ${block.end_line - block.start_line} lines but got ${content.length}`);
    console.warn(`  Block: ${block.type}, lines ${block.start_line}-${block.end_line}`);
    console.warn(`  Total lines available: ${lines.length}`);
  }
  
  return content;
};
```

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HOW TO USE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Apply these changes
2. Open browser console (F12 â†’ Console)
3. Clear console
4. Click "CV Structure" button
5. Read the MOUNT logs - verify cvContent and blocks look correct
6. Click on a section â†’ "Merge with section above"
7. Copy ALL console output
8. Paste here for analysis

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
WHAT TO LOOK FOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PROBLEM INDICATORS:

1. "cvContent is null/undefined" â†’ Parent not passing cvContent
2. "cvContent is empty string" â†’ cvContent.fullText is empty
3. "startIdx >= total lines" â†’ Line numbers from backend are wrong
4. "endIdx <= startIdx" â†’ Block has invalid line range
5. "Content length mismatch" â†’ Something wrong with string concatenation
6. "onStructureChange is not defined" â†’ Callback not passed

CORRECT OUTPUT SHOULD SHOW:

- cvContent: 10000+ chars, 300+ lines
- Above content: 2000+ chars
- Current content: 3000+ chars (for Citi)
- Merged content: 5000+ chars
- onStructureChange called: YES

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
COMPLETION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

After adding logging:
1. Test merge
2. Copy FULL console output
3. Paste here

Type "DEBUG-LOG COMPLETE - READY TO TEST" when done.