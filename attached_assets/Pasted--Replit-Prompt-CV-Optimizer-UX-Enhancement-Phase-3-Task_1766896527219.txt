# Replit Prompt: CV Optimizer UX Enhancement - Phase 3

**Task:** Add Effort-Based Grouping and View Mode Toggle
**Priority:** üü° Medium
**Estimated Effort:** 4-5 hours
**Depends On:** Phase 1 (Category Panel) and Phase 2 (Strengths) completed

---

## ‚ö†Ô∏è CRITICAL INSTRUCTIONS

- Follow these instructions EXACTLY
- Do NOT modify Phases 1 or 2 components
- ADD a new view mode option alongside existing severity view
- Both views should work with category filters from Phase 1

---

## OVERVIEW

This phase adds an alternative way to view suggestions:
1. Toggle between "By Priority" (severity) and "By Effort" views
2. Effort groups: Quick Wins, Medium Effort, Deep Improvements
3. Time estimates for each effort level

---

## TASK 1: Create View Mode Toggle Component

### File: Create `client/src/components/cv-optimizer/ViewModeToggle.tsx`

```tsx
interface ViewModeToggleProps {
  currentMode: 'severity' | 'effort';
  onModeChange: (mode: 'severity' | 'effort') => void;
}

export default function ViewModeToggle({ 
  currentMode, 
  onModeChange 
}: ViewModeToggleProps) {
  return (
    <div className="flex items-center gap-2 mb-4">
      <span className="text-sm text-gray-500">View by:</span>
      <div className="inline-flex rounded-lg border border-gray-200 p-1 bg-gray-50">
        <button
          onClick={() => onModeChange('severity')}
          className={`
            px-4 py-2 text-sm font-medium rounded-md transition-all
            ${currentMode === 'severity'
              ? 'bg-white text-blue-600 shadow-sm'
              : 'text-gray-600 hover:text-gray-800'
            }
          `}
        >
          üìä By Priority
        </button>
        <button
          onClick={() => onModeChange('effort')}
          className={`
            px-4 py-2 text-sm font-medium rounded-md transition-all
            ${currentMode === 'effort'
              ? 'bg-white text-blue-600 shadow-sm'
              : 'text-gray-600 hover:text-gray-800'
            }
          `}
        >
          ‚è±Ô∏è By Effort
        </button>
      </div>
    </div>
  );
}
```

---

## TASK 2: Create Effort Group Component

### File: Create `client/src/components/cv-optimizer/EffortGroupView.tsx`

```tsx
import { useState } from 'react';
import { ChevronDown, ChevronRight, Zap, Wrench, HardHat } from 'lucide-react';

interface Issue {
  id: number;
  issue: string;
  severity: string;
  category: string;
  location: string;
  current_text: string;
  suggested_fix: string;
  fix_difficulty: string;
}

interface EffortGroupViewProps {
  issues: Issue[];
  displayLevel: number;
  expandedIssues: Set<number>;
  onToggleIssue: (id: number) => void;
}

interface EffortGroup {
  id: string;
  title: string;
  icon: React.ReactNode;
  timeEstimate: string;
  difficulty: string;
  color: {
    bg: string;
    border: string;
    text: string;
    badge: string;
  };
}

const EFFORT_GROUPS: EffortGroup[] = [
  {
    id: 'quick',
    title: 'Quick Wins',
    icon: <Zap size={20} />,
    timeEstimate: '~5 min each',
    difficulty: 'quick',
    color: {
      bg: 'bg-green-50',
      border: 'border-green-200',
      text: 'text-green-800',
      badge: 'bg-green-100 text-green-700'
    }
  },
  {
    id: 'medium',
    title: 'Worth the Effort',
    icon: <Wrench size={20} />,
    timeEstimate: '~15 min each',
    difficulty: 'medium',
    color: {
      bg: 'bg-yellow-50',
      border: 'border-yellow-200',
      text: 'text-yellow-800',
      badge: 'bg-yellow-100 text-yellow-700'
    }
  },
  {
    id: 'complex',
    title: 'Deep Improvements',
    icon: <HardHat size={20} />,
    timeEstimate: '~30+ min each',
    difficulty: 'complex',
    color: {
      bg: 'bg-blue-50',
      border: 'border-blue-200',
      text: 'text-blue-800',
      badge: 'bg-blue-100 text-blue-700'
    }
  }
];

export default function EffortGroupView({
  issues,
  displayLevel,
  expandedIssues,
  onToggleIssue
}: EffortGroupViewProps) {
  const [collapsedGroups, setCollapsedGroups] = useState<Set<string>>(new Set());

  const toggleGroup = (groupId: string) => {
    setCollapsedGroups(prev => {
      const next = new Set(prev);
      if (next.has(groupId)) {
        next.delete(groupId);
      } else {
        next.add(groupId);
      }
      return next;
    });
  };

  // Group issues by difficulty
  const groupedIssues = EFFORT_GROUPS.map(group => ({
    ...group,
    issues: issues.filter(issue => issue.fix_difficulty === group.difficulty)
  }));

  // Calculate total time estimate
  const totalMinutes = issues.reduce((acc, issue) => {
    if (issue.fix_difficulty === 'quick') return acc + 5;
    if (issue.fix_difficulty === 'medium') return acc + 15;
    return acc + 30;
  }, 0);

  const formatTotalTime = (minutes: number) => {
    if (minutes < 60) return `${minutes} minutes`;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    return mins > 0 ? `${hours}h ${mins}m` : `${hours} hour${hours > 1 ? 's' : ''}`;
  };

  return (
    <div className="space-y-4">
      {/* Total Time Estimate */}
      <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-gray-500">Estimated total time to implement all suggestions:</p>
            <p className="text-2xl font-bold text-gray-900">{formatTotalTime(totalMinutes)}</p>
          </div>
          <div className="text-right">
            <p className="text-sm text-gray-500">Start with Quick Wins for</p>
            <p className="text-lg font-semibold text-green-600">immediate impact!</p>
          </div>
        </div>
      </div>

      {/* Effort Groups */}
      {groupedIssues.map(group => {
        if (group.issues.length === 0) return null;
        
        const isCollapsed = collapsedGroups.has(group.id);

        return (
          <div 
            key={group.id}
            className={`border ${group.color.border} rounded-xl overflow-hidden`}
          >
            {/* Group Header */}
            <button
              onClick={() => toggleGroup(group.id)}
              className={`
                w-full flex items-center justify-between p-4 
                ${group.color.bg} hover:opacity-90 transition-opacity
              `}
            >
              <div className="flex items-center gap-3">
                {isCollapsed ? (
                  <ChevronRight size={20} className={group.color.text} />
                ) : (
                  <ChevronDown size={20} className={group.color.text} />
                )}
                <span className={group.color.text}>{group.icon}</span>
                <span className={`font-semibold ${group.color.text}`}>
                  {group.title}
                </span>
                <span className={`text-sm px-2 py-1 rounded-full ${group.color.badge}`}>
                  {group.issues.length} suggestion{group.issues.length !== 1 ? 's' : ''}
                </span>
              </div>
              <span className={`text-sm ${group.color.text} opacity-75`}>
                {group.timeEstimate}
              </span>
            </button>

            {/* Group Issues */}
            {!isCollapsed && (
              <div className="p-4 space-y-3 bg-white">
                {group.issues.map(issue => (
                  <IssueCard
                    key={issue.id}
                    issue={issue}
                    displayLevel={displayLevel}
                    isExpanded={expandedIssues.has(issue.id)}
                    onToggle={() => onToggleIssue(issue.id)}
                    effortColor={group.color}
                  />
                ))}
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
}

// Issue Card for Effort View
interface IssueCardProps {
  issue: Issue;
  displayLevel: number;
  isExpanded: boolean;
  onToggle: () => void;
  effortColor: EffortGroup['color'];
}

function IssueCard({ 
  issue, 
  displayLevel, 
  isExpanded, 
  onToggle,
  effortColor 
}: IssueCardProps) {
  // Get severity badge color
  const severityColors: Record<string, string> = {
    critical: 'bg-red-100 text-red-700',
    high: 'bg-orange-100 text-orange-700',
    medium: 'bg-yellow-100 text-yellow-700',
    low: 'bg-green-100 text-green-700'
  };

  return (
    <div className={`border border-gray-200 rounded-lg overflow-hidden`}>
      {/* Card Header */}
      <button
        onClick={onToggle}
        className="w-full flex items-center justify-between p-3 hover:bg-gray-50 text-left"
      >
        <div className="flex items-center gap-3">
          {isExpanded ? (
            <ChevronDown size={18} className="text-gray-400" />
          ) : (
            <ChevronRight size={18} className="text-gray-400" />
          )}
          <span className="font-medium text-gray-900">{issue.issue}</span>
        </div>
        <span className={`text-xs px-2 py-1 rounded-full ${severityColors[issue.severity]}`}>
          {issue.severity}
        </span>
      </button>

      {/* Expanded Content */}
      {isExpanded && displayLevel >= 2 && (
        <div className="p-3 bg-gray-50 border-t border-gray-100">
          {/* Category & Location */}
          <div className="grid grid-cols-2 gap-4 mb-3">
            <div>
              <p className="text-xs text-gray-500 uppercase tracking-wide mb-1">Category</p>
              <p className="text-sm text-gray-700">{issue.category}</p>
            </div>
            <div>
              <p className="text-xs text-gray-500 uppercase tracking-wide mb-1">Location</p>
              <p className="text-sm text-gray-700">{issue.location}</p>
            </div>
          </div>

          {/* Current Text & Fix (Level 3+) */}
          {displayLevel >= 3 && (
            <>
              <div className="mb-3">
                <p className="text-xs text-gray-500 uppercase tracking-wide mb-1">Found</p>
                <div className="bg-red-50 border border-red-200 rounded p-2">
                  <p className="text-red-800 font-mono text-sm">"{issue.current_text}"</p>
                </div>
              </div>
              <div>
                <p className="text-xs text-gray-500 uppercase tracking-wide mb-1">Suggested Fix</p>
                <div className="bg-green-50 border border-green-200 rounded p-2">
                  <p className="text-green-800 text-sm">{issue.suggested_fix}</p>
                </div>
              </div>
            </>
          )}
        </div>
      )}
    </div>
  );
}
```

---

## TASK 3: Update Report Page to Support Both View Modes

### File: Update `client/src/pages/CVReportPage.tsx`

**1. Add imports:**

```tsx
import ViewModeToggle from '../components/cv-optimizer/ViewModeToggle';
import EffortGroupView from '../components/cv-optimizer/EffortGroupView';
```

**2. Add state for view mode:**

```tsx
const [viewMode, setViewMode] = useState<'severity' | 'effort'>('severity');
```

**3. Add ViewModeToggle to JSX (after CategoryFilterPanel, before issues):**

```tsx
{/* View Mode Toggle */}
<ViewModeToggle
  currentMode={viewMode}
  onModeChange={setViewMode}
/>
```

**4. Conditionally render either severity view or effort view:**

```tsx
{/* Issues Display */}
{viewMode === 'severity' ? (
  // EXISTING SEVERITY-BASED VIEW
  <div className="space-y-6">
    {/* Critical/High/Medium/Low sections - keep existing code */}
    ...
  </div>
) : (
  // NEW EFFORT-BASED VIEW
  <EffortGroupView
    issues={filteredIssues}
    displayLevel={displayLevel}
    expandedIssues={expandedIssues}
    onToggleIssue={toggleIssue}
  />
)}
```

---

## TASK 4: Ensure fix_difficulty is Populated

The `fix_difficulty` field should be set by the AI during analysis. Check that:

1. The AI prompt requests `fix_difficulty` for each issue
2. Values are: `"quick"`, `"medium"`, or `"complex"`

### If fix_difficulty is missing, add a default mapping:

```typescript
// Add this utility function
export function getEffortLevel(issue: any): string {
  // If fix_difficulty exists, use it
  if (issue.fix_difficulty) {
    return issue.fix_difficulty;
  }
  
  // Otherwise, infer from severity and category
  if (issue.severity === 'critical') {
    // Critical issues are usually quick fixes (spelling, contact)
    return 'quick';
  }
  
  if (issue.category === 'Spelling & Grammar') return 'quick';
  if (issue.category === 'Personal Information') return 'quick';
  if (issue.category === 'Missing Information') return 'medium';
  if (issue.category === 'Lack of Quantification') return 'medium';
  if (issue.category === 'Weak Presentation') return 'medium';
  if (issue.category === 'Career Narrative') return 'complex';
  if (issue.category === 'Employment Gaps') return 'complex';
  
  // Default to medium
  return 'medium';
}
```

Apply this to issues when loading:

```tsx
const processedIssues = issues.map(issue => ({
  ...issue,
  fix_difficulty: issue.fix_difficulty || getEffortLevel(issue)
}));
```

---

## TASK 5: Add Effort Summary to Results Page

### File: Update `client/src/pages/CVResultsPage.tsx`

Add effort breakdown to the summary:

```tsx
// Calculate effort counts
const effortCounts = useMemo(() => {
  return {
    quick: issues.filter(i => (i.fix_difficulty || getEffortLevel(i)) === 'quick').length,
    medium: issues.filter(i => (i.fix_difficulty || getEffortLevel(i)) === 'medium').length,
    complex: issues.filter(i => (i.fix_difficulty || getEffortLevel(i)) === 'complex').length
  };
}, [issues]);

// Add to JSX after severity breakdown:
<div className="mt-6 pt-4 border-t border-gray-200">
  <p className="text-sm text-gray-500 mb-3">By effort level:</p>
  <div className="flex justify-center gap-6">
    <div className="text-center">
      <span className="text-2xl">‚ö°</span>
      <p className="text-lg font-bold text-green-600">{effortCounts.quick}</p>
      <p className="text-xs text-gray-500">Quick Wins</p>
    </div>
    <div className="text-center">
      <span className="text-2xl">üîß</span>
      <p className="text-lg font-bold text-yellow-600">{effortCounts.medium}</p>
      <p className="text-xs text-gray-500">Medium</p>
    </div>
    <div className="text-center">
      <span className="text-2xl">üèóÔ∏è</span>
      <p className="text-lg font-bold text-blue-600">{effortCounts.complex}</p>
      <p className="text-xs text-gray-500">Deep Work</p>
    </div>
  </div>
</div>
```

---

## VERIFICATION CHECKLIST

After implementation, verify:

### View Mode Toggle
- [ ] Toggle appears above issues list
- [ ] "By Priority" and "By Effort" buttons visible
- [ ] Active button is highlighted
- [ ] Clicking toggles between views
- [ ] Toggle state persists during session

### Effort Group View
- [ ] Quick Wins section appears first (green)
- [ ] Medium Effort section appears second (yellow)
- [ ] Deep Improvements section appears third (blue)
- [ ] Each section shows correct issue count
- [ ] Each section shows time estimate
- [ ] Sections are collapsible (click header)
- [ ] Issues within sections can be expanded
- [ ] Category filters from Phase 1 still work
- [ ] Total time estimate shown at top

### Results Page
- [ ] Effort breakdown shows below severity breakdown
- [ ] Quick/Medium/Complex counts are correct
- [ ] Icons display properly

### Data
- [ ] fix_difficulty field is populated for all issues
- [ ] Fallback logic works if fix_difficulty is missing

---

## FILE STRUCTURE

After all 3 phases, you should have:

```
client/src/
  config/
    cvCategories.ts (Phase 1)
  utils/
    strengthsDetector.ts (Phase 2)
  components/
    cv-optimizer/
      CategoryInfoModal.tsx (Phase 1)
      CategoryFilterPanel.tsx (Phase 1)
      StrengthsSection.tsx (Phase 2)
      EncouragementMessage.tsx (Phase 2)
      ViewModeToggle.tsx (Phase 3 - NEW)
      EffortGroupView.tsx (Phase 3 - NEW)
  pages/
    CVReportPage.tsx (Updated in all phases)
    CVResultsPage.tsx (Updated in Phase 2 & 3)
```

---

## COMPLETE UX FLOW AFTER ALL PHASES

```
1. User uploads CV
2. Scanning animation runs
3. Results Summary shows:
   - Total opportunities (not "issues")
   - Severity breakdown (High-Impact, Important, Consider, Polish)
   - Effort breakdown (Quick Wins, Medium, Deep) ‚Üê NEW
4. User clicks "Show Report"
5. Report shows:
   - ‚ú® Strengths Section (what's good) ‚Üê Phase 2
   - üöÄ Encouragement message ‚Üê Phase 2
   - üìã Category Filter Panel with info modals ‚Üê Phase 1
   - View toggle (By Priority / By Effort) ‚Üê Phase 3
   - Issues grouped by chosen view
   - üéâ Completion encouragement ‚Üê Phase 2
```

---

## SUMMARY OF ALL 3 PHASES

| Phase | What It Adds | User Benefit |
|-------|--------------|--------------|
| **Phase 1** | Category panel, info modals, filters | Transparency & control |
| **Phase 2** | Strengths section, positive language | Emotional support |
| **Phase 3** | Effort grouping, time estimates | Clear action path |

---

**END OF PROMPT - PHASE 3**