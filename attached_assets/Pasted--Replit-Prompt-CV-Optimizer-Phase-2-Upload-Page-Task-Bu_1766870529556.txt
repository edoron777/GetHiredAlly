# Replit Prompt: CV Optimizer - Phase 2 Upload Page

**Task:** Build the CV upload interface with drag & drop and file selection
**Priority:** ğŸ”´ Critical
**Estimated Effort:** 3-4 hours
**Depends On:** Phase 1 (Foundation) completed

---

## âš ï¸ CRITICAL INSTRUCTIONS

- Follow these instructions EXACTLY
- Do NOT add features not requested
- Match the existing application design style

---

## TASK: Build CV Upload Page

### Route: `/service/cv-optimizer`

Replace the placeholder page with the full upload interface.

---

## PAGE STRUCTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Back to Dashboard                                         â”‚
â”‚                                                             â”‚
â”‚ CV Optimizer                                                â”‚
â”‚ Find hidden issues that hurt your chances                   â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚              ğŸ“„                                         â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚     Drag & drop your CV here                           â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚     or                                                  â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚           [Browse Files]                                â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚     Supported: PDF, DOCX, TXT (Max 10MB)               â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OR select a saved CV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ â–¼ Select from your uploaded CVs                 â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â”‚                    [ğŸ” Start Scan]                         â”‚
â”‚                                                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## COMPONENT SPECIFICATIONS

### 1. Page Header

```jsx
<div className="mb-8">
  {/* Back link */}
  <Link to="/" className="flex items-center text-gray-600 hover:text-gray-800 mb-6">
    <ArrowLeft size={20} className="mr-2" />
    Back to Dashboard
  </Link>
  
  {/* Title */}
  <h1 className="text-3xl font-bold text-gray-900 mb-2">
    CV Optimizer
  </h1>
  <p className="text-gray-600">
    Find hidden issues that hurt your chances
  </p>
</div>
```

### 2. Drag & Drop Upload Area

```jsx
<div 
  className={`
    border-2 border-dashed rounded-lg p-12 text-center transition-colors
    ${isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50'}
    ${selectedFile ? 'border-green-500 bg-green-50' : ''}
  `}
  onDragOver={handleDragOver}
  onDragLeave={handleDragLeave}
  onDrop={handleDrop}
>
  {selectedFile ? (
    // File selected state
    <div>
      <FileText size={48} className="mx-auto text-green-500 mb-4" />
      <p className="text-lg font-medium text-gray-900 mb-1">
        {selectedFile.name}
      </p>
      <p className="text-sm text-gray-500 mb-4">
        {formatFileSize(selectedFile.size)}
      </p>
      <button 
        onClick={clearFile}
        className="text-red-500 hover:text-red-700 text-sm"
      >
        Remove file
      </button>
    </div>
  ) : (
    // Empty state
    <div>
      <Upload size={48} className="mx-auto text-gray-400 mb-4" />
      <p className="text-lg font-medium text-gray-700 mb-2">
        Drag & drop your CV here
      </p>
      <p className="text-gray-500 mb-4">or</p>
      <label className="cursor-pointer">
        <span className="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50">
          Browse Files
        </span>
        <input 
          type="file" 
          className="hidden" 
          accept=".pdf,.docx,.doc,.txt"
          onChange={handleFileSelect}
        />
      </label>
      <p className="text-sm text-gray-400 mt-4">
        Supported: PDF, DOCX, TXT (Max 10MB)
      </p>
    </div>
  )}
</div>
```

### 3. Divider

```jsx
<div className="flex items-center my-8">
  <div className="flex-1 border-t border-gray-300"></div>
  <span className="px-4 text-gray-500 text-sm">OR select a saved CV</span>
  <div className="flex-1 border-t border-gray-300"></div>
</div>
```

### 4. Saved CVs Dropdown

```jsx
<div className="mb-8">
  <select
    value={selectedCvId}
    onChange={(e) => setSelectedCvId(e.target.value)}
    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
    disabled={selectedFile !== null}
  >
    <option value="">Select from your uploaded CVs</option>
    {userCvs.map((cv) => (
      <option key={cv.id} value={cv.id}>
        {cv.filename} - Uploaded {formatDate(cv.created_at)}
      </option>
    ))}
  </select>
  
  {userCvs.length === 0 && (
    <p className="text-sm text-gray-500 mt-2">
      No saved CVs found. Upload a new file above.
    </p>
  )}
</div>
```

### 5. Start Scan Button

```jsx
<div className="text-center">
  <button
    onClick={handleStartScan}
    disabled={!selectedFile && !selectedCvId}
    className={`
      px-8 py-3 rounded-lg font-medium text-lg flex items-center justify-center mx-auto
      ${(selectedFile || selectedCvId)
        ? 'bg-blue-600 text-white hover:bg-blue-700'
        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
      }
    `}
  >
    <Search size={20} className="mr-2" />
    Start Scan
  </button>
</div>
```

---

## STATE MANAGEMENT

```jsx
const [selectedFile, setSelectedFile] = useState(null);
const [selectedCvId, setSelectedCvId] = useState('');
const [userCvs, setUserCvs] = useState([]);
const [isDragging, setIsDragging] = useState(false);
const [isLoading, setIsLoading] = useState(false);
const [error, setError] = useState(null);
```

---

## EVENT HANDLERS

### File Drag & Drop

```jsx
const handleDragOver = (e) => {
  e.preventDefault();
  setIsDragging(true);
};

const handleDragLeave = (e) => {
  e.preventDefault();
  setIsDragging(false);
};

const handleDrop = (e) => {
  e.preventDefault();
  setIsDragging(false);
  
  const file = e.dataTransfer.files[0];
  if (file) {
    validateAndSetFile(file);
  }
};
```

### File Selection

```jsx
const handleFileSelect = (e) => {
  const file = e.target.files[0];
  if (file) {
    validateAndSetFile(file);
  }
};
```

### File Validation

```jsx
const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
const ALLOWED_TYPES = [
  'application/pdf',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  'application/msword',
  'text/plain'
];
const ALLOWED_EXTENSIONS = ['pdf', 'docx', 'doc', 'txt'];

const validateAndSetFile = (file) => {
  setError(null);
  
  // Check file extension
  const extension = file.name.split('.').pop().toLowerCase();
  if (!ALLOWED_EXTENSIONS.includes(extension)) {
    setError('Invalid file type. Please upload PDF, DOCX, or TXT.');
    return;
  }
  
  // Check file size
  if (file.size > MAX_FILE_SIZE) {
    setError('File too large. Maximum size is 10MB.');
    return;
  }
  
  setSelectedFile(file);
  setSelectedCvId(''); // Clear dropdown selection
};
```

### Clear File

```jsx
const clearFile = () => {
  setSelectedFile(null);
  setError(null);
};
```

### Start Scan

```jsx
const handleStartScan = async () => {
  setIsLoading(true);
  setError(null);
  
  try {
    let cvContent = '';
    let cvId = null;
    
    if (selectedFile) {
      // Upload file and get content
      const formData = new FormData();
      formData.append('file', selectedFile);
      
      const uploadResponse = await fetch('/api/cv/upload-for-scan', {
        method: 'POST',
        body: formData
      });
      
      if (!uploadResponse.ok) {
        throw new Error('Failed to upload file');
      }
      
      const uploadData = await uploadResponse.json();
      cvContent = uploadData.content;
      cvId = uploadData.cv_id;
      
    } else if (selectedCvId) {
      // Get content from existing CV
      const cvResponse = await fetch(`/api/cv/${selectedCvId}`);
      
      if (!cvResponse.ok) {
        throw new Error('Failed to load CV');
      }
      
      const cvData = await cvResponse.json();
      cvContent = cvData.content;
      cvId = parseInt(selectedCvId);
    }
    
    // Start the scan - redirect to scanning page
    // The actual scan will happen on the scanning page
    window.location.href = `/service/cv-optimizer/scanning?cv_id=${cvId}`;
    
  } catch (err) {
    setError(err.message || 'An error occurred. Please try again.');
    setIsLoading(false);
  }
};
```

---

## FETCH USER'S SAVED CVs

```jsx
useEffect(() => {
  const fetchUserCvs = async () => {
    try {
      const response = await fetch('/api/cv/list');
      if (response.ok) {
        const data = await response.json();
        setUserCvs(data.cvs || []);
      }
    } catch (err) {
      console.error('Failed to fetch CVs:', err);
    }
  };
  
  fetchUserCvs();
}, []);
```

---

## HELPER FUNCTIONS

```jsx
const formatFileSize = (bytes) => {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
```

---

## ERROR DISPLAY

```jsx
{error && (
  <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
    <p className="text-red-700">{error}</p>
  </div>
)}
```

---

## LOADING STATE

```jsx
{isLoading && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div className="bg-white rounded-lg p-6 flex items-center">
      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-4"></div>
      <span>Preparing scan...</span>
    </div>
  </div>
)}
```

---

## API ENDPOINT NEEDED

### POST /api/cv/upload-for-scan

**Purpose:** Upload a CV file, extract text content, save to database

**Request:** FormData with file

**Response:**
```json
{
  "cv_id": 123,
  "filename": "my_resume.pdf",
  "content": "Extracted text content of the CV...",
  "size": 245678
}
```

**Implementation Notes:**
- Extract text from PDF (use pdf-parse or similar)
- Extract text from DOCX (use mammoth or similar)
- Read TXT directly
- Save to user_cvs table if not already saved
- Return extracted text content

---

## IMPORTS NEEDED

```jsx
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { ArrowLeft, Upload, FileText, Search } from 'lucide-react';
```

---

## COMPLETE PAGE COMPONENT

```jsx
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { ArrowLeft, Upload, FileText, Search } from 'lucide-react';

export default function CVOptimizerPage() {
  const [selectedFile, setSelectedFile] = useState(null);
  const [selectedCvId, setSelectedCvId] = useState('');
  const [userCvs, setUserCvs] = useState([]);
  const [isDragging, setIsDragging] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  
  // ... all the functions from above ...
  
  return (
    <div className="max-w-2xl mx-auto p-6">
      {/* Header */}
      {/* Error display */}
      {/* Upload area */}
      {/* Divider */}
      {/* Dropdown */}
      {/* Button */}
      {/* Loading overlay */}
    </div>
  );
}
```

---

## VERIFICATION CHECKLIST

After implementation, verify:

- [ ] Page loads at `/service/cv-optimizer`
- [ ] Back link works (returns to dashboard)
- [ ] Drag & drop area is visible
- [ ] Dragging a file highlights the drop area (blue border)
- [ ] Dropping a valid file shows file name and size
- [ ] "Browse Files" button opens file picker
- [ ] Invalid file types show error message
- [ ] Files > 10MB show error message
- [ ] "Remove file" clears the selection
- [ ] Dropdown shows user's saved CVs (or empty message)
- [ ] Selecting a CV from dropdown disables file upload visual
- [ ] "Start Scan" button is disabled when nothing selected
- [ ] "Start Scan" button is enabled when file or CV selected
- [ ] Clicking "Start Scan" shows loading state
- [ ] After processing, redirects to `/service/cv-optimizer/scanning?cv_id=X`

---

## NEXT STEP

After this prompt is implemented, the next step is:
- **Prompt 3:** Scanning Animation Page

---

**END OF PROMPT**