## TASK: Create Smart Questions AI Prompt Template

### OVERVIEW
Create the prompt template that will be sent to Gemini to generate personalized interview questions.

### STEP 1: Create Prompt Builder File

Create file: backend/prompts/smart_questions_prompt.py

def build_smart_questions_prompt(xray_data: str, cv_text: str = None) -> str:
    """Build the prompt for Gemini to generate personalized interview questions"""
    
    prompt = """You are an expert interview coach helping a job seeker prepare for their interview.

## YOUR TASK
Analyze the job requirements and candidate's background to:
1. Identify 3-5 potential weak areas where the candidate might struggle
2. Generate 25-30 personalized interview questions most likely to be asked

## JOB INFORMATION
"""
    prompt += xray_data
    
    if cv_text:
        prompt += """

## CANDIDATE'S CV/RESUME
"""
        prompt += cv_text
    
    prompt += """

## OUTPUT FORMAT
Respond ONLY with valid JSON in this exact format (no markdown, no backticks, no explanation):

{
    "weak_areas": [
        {
            "area": "Name of weak area",
            "risk_level": "high|medium|low",
            "detection_reason": "Why this is a potential gap",
            "preparation_tip": "How to prepare for questions about this",
            "sample_answer_approach": "Brief guidance on how to answer"
        }
    ],
    "questions": [
        {
            "category": "universal|behavioral|situational|self_assessment|cultural_fit",
            "question_text": "The interview question",
            "personalized_context": "Why this question is relevant for THIS candidate/job",
            "why_they_ask": "What the interviewer wants to learn",
            "good_answer_example": "Template for a strong answer",
            "what_to_avoid": "Common mistakes to avoid",
            "source": "jd_requirement|cv_gap|cv_strength|common_question"
        }
    ]
}

## RULES FOR WEAK AREAS
1. Identify 3-5 areas where the candidate might face tough questions
2. Look for: skill gaps, experience mismatches, career transitions, employment gaps, overqualification, underqualification
3. For each area, provide actionable preparation tips
4. Risk levels: high = likely to be asked and could hurt, medium = might come up, low = possible but manageable

## RULES FOR QUESTIONS
1. Generate exactly 25-30 questions
2. Prioritize questions that are MOST LIKELY for THIS specific job
3. Include a mix of categories:
   - 5-7 Universal questions (customized for this role)
   - 8-10 Behavioral questions (based on job requirements)
   - 4-6 Situational questions (based on job challenges)
   - 4-5 Self-Assessment questions
   - 3-4 Cultural Fit questions
4. Each question must have personalized context explaining why it's relevant
5. Mark the source of each question:
   - jd_requirement: Based on specific job requirement
   - cv_gap: Addresses a gap in candidate's background
   - cv_strength: Allows candidate to highlight a strength
   - common_question: Standard question for this role type

## PERSONALIZATION REQUIREMENTS
- Reference specific skills/tools mentioned in the job description
- If CV provided, reference specific experiences from the CV
- Include company-specific questions if company name is known
- Adjust difficulty based on seniority level of the role

Now generate the JSON output:"""
    
    return prompt


def parse_gemini_response(response_text: str) -> dict:
    """Parse the JSON response from Gemini"""
    import json
    
    # Clean up response - remove markdown code blocks if present
    text = response_text.strip()
    if text.startswith("```json"):
        text = text[7:]
    if text.startswith("```"):
        text = text[3:]
    if text.endswith("```"):
        text = text[:-3]
    
    # Parse JSON
    result = json.loads(text.strip())
    
    # Validate structure
    if "weak_areas" not in result:
        result["weak_areas"] = []
    if "questions" not in result:
        result["questions"] = []
    
    return result

### STEP 2: Import in Router

In backend/routers/smart_questions.py, add:
from prompts.smart_questions_prompt import build_smart_questions_prompt, parse_gemini_response

### SUCCESS CHECKLIST
- [ ] Prompt template created
- [ ] Parser handles JSON with/without markdown
- [ ] Prompt includes job info and CV (when provided)
- [ ] Output format is well-defined
- [ ] Personalization rules are clear